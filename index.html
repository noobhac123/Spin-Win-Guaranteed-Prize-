<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spin & Win Guaranteed Prize!</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lobster&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-color: #6a0dad;
            --secondary-color: #c83795;
            --accent-color: #ffd700;
            --pointer-color: #ffffff;
            --number-highlight-color: #ffd700;
            --text-color: #ffffff;
            --text-dark: #333333;
            --glow-color: rgba(255, 223, 0, 0.75);
            --modal-bg: linear-gradient(145deg, rgba(60, 0, 90, 0.96), rgba(120, 30, 90, 0.96));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color) 70%, var(--accent-color) 100%);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
            text-align: center;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .app-container {
            background: rgba(0, 0, 0, 0.42);
            padding: 20px;
            border-radius: 28px;
            box-shadow: 0 15px 45px rgba(0,0,0,0.68);
            width: 100%;
            max-width: 680px;
        }

        header h1 {
            font-family: 'Lobster', cursive;
            font-size: 3em;
            color: var(--accent-color);
            text-shadow: 3px 3px 7px rgba(0,0,0,0.7);
            margin-bottom: 30px;
        }

        .wheel-container {
            position: relative;
            width: 90vw;
            max-width: 520px;
            height: 90vw;
            max-height: 520px;
            margin: 0 auto 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wheel-pointer {
            width: 0;
            height: 0;
            border-left: 34px solid transparent;
            border-right: 34px solid transparent;
            border-top: 51px solid var(--pointer-color);
            position: absolute;
            top: -17px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            filter: drop-shadow(0px 6px 6px rgba(0,0,0,0.7));
        }

        #spinWheelImage {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 8s cubic-bezier(0.15, 0.9, 0.2, 1);
        }

        #coverImage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 80px;
            max-height: 80px;
            width: 15%;
            height: auto;
            z-index: 5;
        }


        .action-button {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.35em;
            padding: 16px 38px;
            border: none;
            border-radius: 60px;
            color: var(--text-dark);
            background: linear-gradient(45deg, var(--accent-color), #ffc107);
            cursor: pointer;
            box-shadow: 0 0 16px var(--glow-color), 0 0 32px var(--glow-color);
            transition: all 0.3s ease-in-out;
            display: inline-block;
            width: auto; 
        }
        
        .action-button.full-width {
            width: 100%;
        }


        #spinButton {
            margin-top: 10px;
            margin-bottom: 35px;
        }

        #spinButton.initial-glow {
             animation: pulseGlow 1.7s infinite ease-in-out;
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 0 16px var(--glow-color), 0 0 32px var(--glow-color);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 22px var(--glow-color), 0 0 44px var(--glow-color), 0 0 60px var(--glow-color);
                transform: scale(1.08);
            }
        }

        .action-button:hover:not(:disabled) {
            transform: translateY(-6px) scale(1.08);
            box-shadow: 0 0 22px var(--glow-color), 0 0 44px var(--glow-color), 0 0 65px var(--glow-color);
        }

        .action-button:active:not(:disabled) {
            transform: translateY(1px) scale(0.95);
            box-shadow: 0 0 14px var(--glow-color), 0 0 28px var(--glow-color);
        }

        .action-button:disabled {
            background: #909090;
            color: #333333;
            cursor: not-allowed;
            box-shadow: none;
            animation: none;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0s linear 0.4s;
            padding: 15px;
        }

        .modal.visible {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.4s ease, visibility 0s linear 0s;
        }

        .modal-content {
            background: var(--modal-bg);
            padding: 30px 25px; 
            border: 3px solid var(--accent-color);
            border-radius: 25px;
            width: 95%;
            max-width: 480px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.7), 0 0 30px var(--glow-color);
            text-align: center;
            position: relative;
            transform: scale(0.8) translateY(20px);
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease;
        }
        .modal.visible .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-content p {
            margin-bottom: 15px; 
            font-size: 1.2em;   
            line-height: 1.6;
        }
        .modal-content p#winMessageInModal { 
            font-weight: 700;
            color: var(--accent-color);
            font-size: 1.6em; 
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .highlight-number {
            font-weight: 700;
            color: var(--number-highlight-color);
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .claim-details-group { 
            margin-top: 20px; 
            margin-bottom: 25px; 
        }
        .claim-details-group input {
            width: 100%; 
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid var(--accent-color);
            background: rgba(255,255,255,0.92);
            color: var(--text-dark);
            font-size: 1em;
            box-sizing: border-box; 
        }
        .claim-details-group input::placeholder {
            color: #777;
        }
        
        .modal-content .action-button#whatsappShareButtonInModal { 
            margin-top: 0; 
            font-size: 1.1em;
            padding: 12px 25px;
            width: 100%; 
        }


        .content-section#successMessageArea { 
            margin-top: 35px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(30px);
            transition: opacity 0.5s ease, visibility 0s linear 0.5s, transform 0.5s ease;
            max-height: 0;
            overflow: hidden;
        }

        .content-section#successMessageArea.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            transition: opacity 0.5s ease, visibility 0s linear 0s, transform 0.5s ease, max-height 0.5s ease-in-out 0.2s;
            max-height: 750px;
        }
         #successMessageArea p {
            font-size: 1.3em;
            line-height: 1.7;
        }
         #successMessageArea p:first-child {
            font-weight: bold;
            color: var(--accent-color);
            font-size: 1.6em;
        }


        #confettiCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        @media (max-width: 768px) {
            .app-container { max-width: 96%; padding: 15px; }
            header h1 { font-size: 2.6em; margin-bottom: 25px; }
            .wheel-container {
                max-width: 420px;
                max-height: 420px;
                margin-bottom: 25px;
            }
            .wheel-pointer {
                border-left-width: 29px;
                border-right-width: 29px;
                border-top-width: 44px;
                top: -14px;
            }
            #coverImage { max-width: 70px; max-height: 70px; width: 16%;}

            .action-button { font-size: 1.25em; padding: 15px 32px; }
            .modal-content { max-width: 420px; padding: 25px 20px; }
            .modal-content p { font-size: 1.15em; }
            .modal-content p#winMessageInModal { font-size: 1.5em; }
        }

        @media (max-width: 520px) {
             header h1 { font-size: 2.3em; margin-bottom: 20px; }
             .app-container { padding: 15px;}
            .wheel-container {
                max-width: 360px;
                max-height: 360px;
                margin-bottom: 20px;
            }
            .wheel-pointer {
                border-left-width: 24px;
                border-right-width: 24px;
                border-top-width: 36px;
                top: -12px;
            }
             #coverImage { max-width: 60px; max-height: 60px; width: 16%;}

            .action-button { font-size: 1.2em; padding: 14px 28px; }
             .modal-content .action-button#whatsappShareButtonInModal { font-size: 1.1em; padding: 12px 22px;}

            .modal-content { width: 94%; max-width: 380px; padding: 20px 15px;}
            .modal-content p { font-size: 1.05em; }
            .modal-content p#winMessageInModal { font-size: 1.3em; }
            .claim-details-group input { font-size: 0.95em; padding: 10px; }
        }

        @media (max-width: 400px) {
             header h1 { font-size: 2em; margin-bottom: 15px;}
             .wheel-container {
                max-width: 300px;
                max-height: 300px;
            }
            .wheel-pointer {
                border-left-width: 20px;
                border-right-width: 20px;
                border-top-width: 30px;
                top: -10px;
            }
            #coverImage { max-width: 50px; max-height: 50px; width: 16%;}

            .modal-content p { font-size: 1em; }
            .modal-content p#winMessageInModal { font-size: 1.2em; }
            .action-button { font-size: 1.1em; padding: 12px 22px; }
        }

    </style>
</head>
<body>
    <!-- Single Audio element -->
    <audio id="gameAudioPlayer" preload="auto"></audio>

    <div class="app-container">
        <header>
            <h1>Spin the Wheel & Win a Guaranteed Prize!</h1>
        </header>

        <main>
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <img src="spin.png" alt="Spin Wheel" id="spinWheelImage">
                <img src="cover.png" alt="Wheel Cover" id="coverImage">
            </div>

            <button id="spinButton" class="action-button initial-glow">SPIN NOW</button>

            <div id="successMessageArea" class="content-section">
                <p>Your prize claim has been submitted successfully!</p>
                <p>Congratulations again! You will be contacted soon.</p>
            </div>
        </main>
    </div>

    <!-- Win Modal -->
    <div id="winModal" class="modal">
        <div class="modal-content">
            <p id="winMessageInModal"></p>
            <p id="sharePromptInModal">To claim your prize, share this page with <span class="highlight-number">10</span> WhatsApp friends.</p>
            
            <div class="claim-details-group">
                <input type="text" id="userNameInModal" placeholder="Your Name" required>
                <input type="tel" id="userMobileInModal" placeholder="Mobile Number (10 digits)" required pattern="[6-9][0-9]{9}" title="Please enter a valid 10-digit mobile number.">
            </div>
            
            <button id="whatsappShareButtonInModal" class="action-button">Share on WhatsApp & Claim</button>
        </div>
    </div>

    <canvas id="confettiCanvas"></canvas>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Prize Data ---
            const prizes = [
                { name: "₹100 PayTM Cash", isReal: true }, { name: "Movie Ticket", isReal: true },
                { name: "iPhone 14", isReal: true }, { name: "Samsung TV", isReal: true },
                { name: "Smartwatch", isReal: true }, { name: "Bluetooth Speaker", isReal: true },
                { name: "AirPods", isReal: true }, { name: "Better Luck Next Time", isReal: false },
                { name: "Amazon Voucher ₹50", isReal: true }, { name: "Free Coffee Coupon", isReal: true },
                { name: "20% Discount Voucher", isReal: true }, { name: "Surprise Gift Box", isReal: true }
            ];
            const totalSegments = prizes.length;
            const segmentAngle = 360 / totalSegments;
            const winnablePrizes = prizes
                .map((prize, index) => ({ ...prize, originalIndex: index }))
                .filter(prize => prize.isReal);

            // --- DOM Elements ---
            const spinWheelImage = document.getElementById('spinWheelImage');
            const spinButton = document.getElementById('spinButton');
            const gameAudioPlayer = document.getElementById('gameAudioPlayer');
            const winModal = document.getElementById('winModal');
            const winMessageInModal = document.getElementById('winMessageInModal');
            const whatsappShareButtonInModal = document.getElementById('whatsappShareButtonInModal');
            const userNameInModal = document.getElementById('userNameInModal');
            const userMobileInModal = document.getElementById('userMobileInModal');
            const successMessageArea = document.getElementById('successMessageArea');
            const confettiCanvas = document.getElementById('confettiCanvas');
            const confettiInstance = confetti.create(confettiCanvas, { resize: true, useWorker: true });

            // --- State Variables ---
            let isSpinning = false;
            let currentRotation = 0;
            let currentSelectedPrize;
            
            // --- Audio Settings ---
            const SPIN_SOUND_SRC = "spin.mp3"; 
            const WIN_SOUND_SRC = "win.mp3";
            const GENERAL_AUDIO_VOLUME = 0.3; 
            const WIN_SOUND_ADJUSTMENT = 0.15; 

            // --- Audio Helper Functions ---
            function playSound(soundSrc, loopSound = false) {
                if (!gameAudioPlayer) {
                    console.error("gameAudioPlayer element not found!");
                    return;
                }
                
                let targetVolume = GENERAL_AUDIO_VOLUME;
                if (soundSrc === WIN_SOUND_SRC) {
                    targetVolume = WIN_SOUND_ADJUSTMENT;
                }
                
                console.log(`Attempting to play sound: ${soundSrc}, loop: ${loopSound}, target volume: ${targetVolume}`);

                if (!gameAudioPlayer.paused) {
                    gameAudioPlayer.pause();
                }

                gameAudioPlayer.src = soundSrc;
                gameAudioPlayer.loop = loopSound;
                gameAudioPlayer.volume = targetVolume; 
                gameAudioPlayer.currentTime = 0; 
                gameAudioPlayer.load(); 
                
                const playPromise = gameAudioPlayer.play();

                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log(`${soundSrc} playback started successfully at volume ${gameAudioPlayer.volume}.`);
                    }).catch(error => {
                        console.error(`Error playing ${soundSrc}: `, error);
                    });
                } else {
                    console.warn(`${soundSrc}.play() did not return a promise.`);
                }
            }

            function stopSound() {
                if (gameAudioPlayer && !gameAudioPlayer.paused) {
                    console.log("Stopping sound on gameAudioPlayer.");
                    gameAudioPlayer.pause();
                    gameAudioPlayer.currentTime = 0;
                }
            }

            // --- Event Listeners ---
            spinButton.addEventListener('click', () => {
                if (isSpinning) return;
                isSpinning = true;
                spinButton.disabled = true;
                spinButton.classList.remove('initial-glow');

                stopSound(); 
                successMessageArea.classList.remove('visible');
                winModal.classList.remove('visible'); 

                playSound(SPIN_SOUND_SRC, true); 

                const randomIndex = Math.floor(Math.random() * winnablePrizes.length);
                currentSelectedPrize = winnablePrizes[randomIndex];
                const winningSegmentIndex = currentSelectedPrize.originalIndex;

                const prizeTrueCenterAngleOnImage = winningSegmentIndex * segmentAngle;
                const targetAngleInCycle = (360 - prizeTrueCenterAngleOnImage + 360) % 360;

                const numFullSpins = 8 + Math.floor(Math.random() * 8);
                const prevFullRotations = Math.floor(currentRotation / 360);
                let targetRotation = (prevFullRotations + numFullSpins) * 360 + targetAngleInCycle;

                if (targetRotation <= currentRotation + 360 * 3) {
                     targetRotation += 360 * (3 + Math.floor(Math.random()*3));
                }

                spinWheelImage.style.transform = `rotate(${targetRotation}deg)`;
                currentRotation = targetRotation;

                spinWheelImage.addEventListener('transitionend', handleVisualSpinEnd, { once: true });
            });

            function handleVisualSpinEnd() {
                isSpinning = false;
                stopSound(); 

                if (currentSelectedPrize) {
                    winMessageInModal.textContent = `Congratulations! You won ${currentSelectedPrize.name}!`;
                } else {
                    winMessageInModal.textContent = `Congratulations! You won a prize!`; // Fallback
                }
                
                userNameInModal.value = ''; 
                userMobileInModal.value = ''; 

                winModal.classList.add('visible');
                
                setTimeout(() => {
                    playSound(WIN_SOUND_SRC, false); 
                }, 100); 

                confettiInstance({ particleCount: 300, spread: 120, origin: { y: 0.45 }, zIndex: 9999 });
            }

            window.addEventListener('beforeunload', stopSound);

            whatsappShareButtonInModal.addEventListener('click', () => {
                stopSound();
                const userName = userNameInModal.value.trim();
                const userMobile = userMobileInModal.value.trim();

                if (!userName || !userMobile) {
                    alert('Please fill in Your Name and Mobile Number to claim your prize.');
                    if (!userName) userNameInModal.focus();
                    else userMobileInModal.focus();
                    return; 
                }
                if (!/^[6-9][0-9]{9}$/.test(userMobile)) {
                    alert('Please enter a valid 10-digit mobile number.');
                    userMobileInModal.focus();
                    return;
                }

                console.log('Claim details (via WhatsApp share action):', { name: userName, mobile: userMobile, prize: currentSelectedPrize ? currentSelectedPrize.name : 'Unknown Prize' });

                const pageUrl = window.location.href;
                const prizeNameForMessage = currentSelectedPrize ? currentSelectedPrize.name : 'an Awesome Prize';
                const userNameForMessage = userName ? userName : "I"; // Use "I" if name is somehow empty, though validation should prevent it.

                // Your chosen WhatsApp message structure:
                const messageText = `🎉 OMG! You won't believe this! 🎉\n\nMy name is ${userNameForMessage}, and I just won brand new *${prizeNameForMessage}* on this awesome Spin & Win game! 🤩 I've already claimed my prize! 🎁\n\nYou HAVE to try your luck too! Who knows what you might win? 😉\nTap here to spin: ${pageUrl}\n\nGood luck! 🍀`;
                
                const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(messageText)}`;
                
                window.open(whatsappUrl, '_blank');
                
                winModal.classList.remove('visible');
                successMessageArea.classList.add('visible');
                successMessageArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });

            // --- Initial Checks ---
            if (!gameAudioPlayer) {
                console.error("CRITICAL: gameAudioPlayer HTML tag not found!");
            } else {
                 console.log("gameAudioPlayer found.");
                 gameAudioPlayer.volume = GENERAL_AUDIO_VOLUME;
            }
        });
    </script>
</body>
</html>