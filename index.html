<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Spin & Win - Win Guaranteed Awesome Prizes!</title>
    <meta name="description" content="Try your luck on the exciting Spin Wheel! Spin to win amazing guaranteed prizes like PayTM Cash, Movie Tickets, Gadgets, and more. Share with friends to claim your win!">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://spin-win-guaranteed-prize.vercel.app/"> 
    <meta property="og:title" content="Spin & Win - Win Guaranteed Awesome Prizes!">
    <meta property="og:description" content="Spin the wheel for a chance to win fantastic prizes! It's fun, easy, and you're guaranteed to win something.">
    <meta property="og:image" content="https://spin-win-guaranteed-prize.vercel.app/thumb.jpg"> 
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Spin & Win Bonanza">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://spin-win-guaranteed-prize.vercel.app/">
    <meta name="twitter:title" content="Spin & Win - Win Guaranteed Awesome Prizes!">
    <meta name="twitter:description" content="Spin the wheel for a chance to win fantastic prizes! It's fun, easy, and you're guaranteed to win something.">
    <meta name="twitter:image" content="https://spin-win-guaranteed-prize.vercel.app/thumb.jpg"> 

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lobster&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-color: #6a0dad;
            --secondary-color: #c83795;
            --accent-color: #ffd700;
            --pointer-color: #ffffff;
            --number-highlight-color: #ffd700;
            --text-color: #ffffff;
            --text-dark: #333333;
            --glow-color: rgba(255, 223, 0, 0.75);
            --modal-bg: linear-gradient(145deg, rgba(60, 0, 90, 0.96), rgba(120, 30, 90, 0.96));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color) 70%, var(--accent-color) 100%);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
            text-align: center;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .app-container {
            background: rgba(0, 0, 0, 0.42);
            padding: 20px;
            border-radius: 28px;
            box-shadow: 0 15px 45px rgba(0,0,0,0.68);
            width: 100%;
            max-width: 680px;
        }

        header h1 {
            font-family: 'Lobster', cursive;
            font-size: 3em;
            color: var(--accent-color);
            text-shadow: 3px 3px 7px rgba(0,0,0,0.7);
            margin-bottom: 30px;
        }

        .wheel-container {
            position: relative;
            width: 90vw;
            max-width: 520px;
            height: 90vw;
            max-height: 520px;
            margin: 0 auto 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wheel-pointer {
            width: 0;
            height: 0;
            border-left: 34px solid transparent;
            border-right: 34px solid transparent;
            border-top: 51px solid var(--pointer-color);
            position: absolute;
            top: -17px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            filter: drop-shadow(0px 6px 6px rgba(0,0,0,0.7));
        }

        #spinWheelImage {
            width: 100%;
            height: 100%;
            object-fit: contain;
            /* transition property is set in JS for better control before each spin */
        }

        #coverImage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 80px;
            max-height: 80px;
            width: 15%;
            height: auto;
            z-index: 5;
        }


        .action-button {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.35em;
            padding: 16px 38px;
            border: none;
            border-radius: 60px;
            color: var(--text-dark);
            background: linear-gradient(45deg, var(--accent-color), #ffc107);
            cursor: pointer;
            box-shadow: 0 0 16px var(--glow-color), 0 0 32px var(--glow-color);
            transition: all 0.3s ease-in-out;
            display: inline-block;
            width: auto; 
        }
        
        .action-button.full-width {
            width: 100%;
        }


        #spinButton {
            margin-top: 10px;
            margin-bottom: 20px; 
        }

        #spinButton.initial-glow {
             animation: pulseGlow 1.7s infinite ease-in-out;
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 0 16px var(--glow-color), 0 0 32px var(--glow-color);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 22px var(--glow-color), 0 0 44px var(--glow-color), 0 0 60px var(--glow-color);
                transform: scale(1.08);
            }
        }

        .action-button:hover:not(:disabled) {
            transform: translateY(-6px) scale(1.08);
            box-shadow: 0 0 22px var(--glow-color), 0 0 44px var(--glow-color), 0 0 65px var(--glow-color);
        }

        .action-button:active:not(:disabled) {
            transform: translateY(1px) scale(0.95);
            box-shadow: 0 0 14px var(--glow-color), 0 0 28px var(--glow-color);
        }

        .action-button:disabled {
            background: #909090;
            color: #333333;
            cursor: not-allowed;
            box-shadow: none;
            animation: none;
        }

        /* Ad container styling */
        .ad-container {
            margin-bottom: 15px; /* Space below each ad container */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            flex-direction: column; 
        }
        .ad-container:last-of-type { /* Applies to the last ad container before success message */
             margin-bottom: 20px; 
        }


        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0s linear 0.4s;
            padding: 15px;
        }

        .modal.visible {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.4s ease, visibility 0s linear 0s;
        }

        .modal-content {
            background: var(--modal-bg);
            padding: 30px 25px; 
            border: 3px solid var(--accent-color);
            border-radius: 25px;
            width: 95%;
            max-width: 480px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.7), 0 0 30px var(--glow-color);
            text-align: center;
            position: relative;
            transform: scale(0.8) translateY(20px);
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease;
        }
        .modal.visible .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-content p {
            margin-bottom: 15px; 
            font-size: 1.2em;   
            line-height: 1.6;
        }
        .modal-content p#winMessageInModal { 
            font-weight: 700;
            color: var(--accent-color);
            font-size: 1.6em; 
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .highlight-number {
            font-weight: 700;
            color: var(--number-highlight-color);
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .claim-details-group { 
            margin-top: 20px; 
            margin-bottom: 25px; 
        }
        .claim-details-group input {
            width: 100%; 
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid var(--accent-color);
            background: rgba(255,255,255,0.92);
            color: var(--text-dark);
            font-size: 1em;
            box-sizing: border-box; 
        }
        .claim-details-group input::placeholder {
            color: #777;
        }
        
        .modal-content .action-button#whatsappShareButtonInModal { 
            margin-top: 0; 
            font-size: 1.1em;
            padding: 12px 25px;
            width: 100%; 
        }


        .content-section#successMessageArea { 
            margin-top: 20px; 
            padding: 30px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(30px);
            transition: opacity 0.5s ease, visibility 0s linear 0.5s, transform 0.5s ease;
            max-height: 0;
            overflow: hidden;
        }

        .content-section#successMessageArea.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            transition: opacity 0.5s ease, visibility 0s linear 0s, transform 0.5s ease, max-height 0.5s ease-in-out 0.2s;
            max-height: 750px;
        }
         #successMessageArea p {
            font-size: 1.3em;
            line-height: 1.7;
        }
         #successMessageArea p:first-child {
            font-weight: bold;
            color: var(--accent-color);
            font-size: 1.6em;
        }


        #confettiCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        @media (max-width: 768px) {
            .app-container { max-width: 96%; padding: 15px; }
            header h1 { font-size: 2.6em; margin-bottom: 25px; }
            .wheel-container {
                max-width: 420px;
                max-height: 420px;
                margin-bottom: 25px;
            }
            .wheel-pointer {
                border-left-width: 29px;
                border-right-width: 29px;
                border-top-width: 44px;
                top: -14px;
            }
            #coverImage { max-width: 70px; max-height: 70px; width: 16%;}

            .action-button { font-size: 1.25em; padding: 15px 32px; }
            .modal-content { max-width: 420px; padding: 25px 20px; }
            .modal-content p { font-size: 1.15em; }
            .modal-content p#winMessageInModal { font-size: 1.5em; }
        }

        @media (max-width: 520px) {
             header h1 { font-size: 2.3em; margin-bottom: 20px; }
             .app-container { padding: 15px;}
            .wheel-container {
                max-width: 360px;
                max-height: 360px;
                margin-bottom: 20px;
            }
            .wheel-pointer {
                border-left-width: 24px;
                border-right-width: 24px;
                border-top-width: 36px;
                top: -12px;
            }
             #coverImage { max-width: 60px; max-height: 60px; width: 16%;}

            .action-button { font-size: 1.2em; padding: 14px 28px; }
             .modal-content .action-button#whatsappShareButtonInModal { font-size: 1.1em; padding: 12px 22px;}

            .modal-content { width: 94%; max-width: 380px; padding: 20px 15px;}
            .modal-content p { font-size: 1.05em; }
            .modal-content p#winMessageInModal { font-size: 1.3em; }
            .claim-details-group input { font-size: 0.95em; padding: 10px; }
        }

        @media (max-width: 400px) {
             header h1 { font-size: 2em; margin-bottom: 15px;}
             .wheel-container {
                max-width: 300px;
                max-height: 300px;
            }
            .wheel-pointer {
                border-left-width: 20px;
                border-right-width: 20px;
                border-top-width: 30px;
                top: -10px;
            }
            #coverImage { max-width: 50px; max-height: 50px; width: 16%;}

            .modal-content p { font-size: 1em; }
            .modal-content p#winMessageInModal { font-size: 1.2em; }
            .action-button { font-size: 1.1em; padding: 12px 22px; }
        }

    </style>
</head>
<body>
    <!-- Single Audio element -->
    <audio id="gameAudioPlayer" preload="auto"></audio>

    <div class="app-container">
        <header>
            <h1>Spin the Wheel & Win a Guaranteed Prize!</h1>
        </header>

        <main>
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <!-- ZAROORI: Server par 'spin.png' aur 'cover.png' ka path check karein! -->
                <!-- Agar 'assets' folder mein hain, toh 'assets/spin.png' likhein. -->
                <img src="spin.png" alt="Spin Wheel" id="spinWheelImage"> 
                <img src="cover.png" alt="Wheel Cover" id="coverImage"> 
            </div>

            <button id="spinButton" class="action-button initial-glow">SPIN NOW</button>
            
            <!-- START OF FIRST AD CODE -->
            <div class="ad-container">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '1a7895fd074e3000c41f8d3d72db5afc',
                        'format' : 'iframe',
                        'height' : 50,
                        'width' : 320,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//maintaintournamentslick.com/1a7895fd074e3000c41f8d3d72db5afc/invoke.js"></script>
            </div>
            <!-- END OF FIRST AD CODE -->

            <!-- START OF SECOND AD CODE -->
            <div class="ad-container">
                <script async="async" data-cfasync="false" src="//maintaintournamentslick.com/6a70dc71175dac093c8263d90c7a888a/invoke.js"></script>
                <div id="container-6a70dc71175dac093c8263d90c7a888a"></div>
            </div>
            <!-- END OF SECOND AD CODE -->

            <!-- START OF THIRD AD CODE -->
            <div class="ad-container">
                <script type="text/javascript">
                    atOptions = {
                        'key' : 'ce546bc4fe2e075e0cb10c75198633bb',
                        'format' : 'iframe',
                        'height' : 250,
                        'width' : 300,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//maintaintournamentslick.com/ce546bc4fe2e075e0cb10c75198633bb/invoke.js"></script>
            </div>
            <!-- END OF THIRD AD CODE -->

            <!-- START OF NEW AD (FOURTH AD - Before Social Bar) -->
            <div class="ad-container">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '3b53c22fb6d14ddac112bd77f1fe21ee',
                        'format' : 'iframe',
                        'height' : 50,
                        'width' : 320,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//maintaintournamentslick.com/3b53c22fb6d14ddac112bd77f1fe21ee/invoke.js"></script>
            </div>
            <!-- END OF NEW AD (FOURTH AD) -->
            
            <!-- START OF SOCIAL BAR AD SCRIPT (FIFTH AD) -->
            <div class="ad-container"> 
                <script type='text/javascript' src='//maintaintournamentslick.com/0e/12/a0/0e12a063575ec1758d9d334f248df84b.js'></script>
            </div>
            <!-- END OF SOCIAL BAR AD SCRIPT (FIFTH AD) -->


            <div id="successMessageArea" class="content-section">
                <p>Your prize claim has been submitted successfully!</p>
                <p>Congratulations again! You will be contacted soon.</p>
            </div>
        </main>
    </div>

    <!-- Win Modal -->
    <div id="winModal" class="modal">
        <div class="modal-content">
            <p id="winMessageInModal"></p>
            <p id="sharePromptInModal">To claim your prize, share this page with <span class="highlight-number">10</span> WhatsApp friends.</p>
            
            <div class="claim-details-group">
                <input type="text" id="userNameInModal" placeholder="Your Name" required>
                <input type="tel" id="userMobileInModal" placeholder="Mobile Number (10 digits)" required pattern="[6-9][0-9]{9}" title="Please enter a valid 10-digit mobile number.">
            </div>
            
            <button id="whatsappShareButtonInModal" class="action-button">Share on WhatsApp & Claim</button>
        </div>
    </div>

    <canvas id="confettiCanvas"></canvas>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DEBUG: DOMContentLoaded event fired.");

            const prizes = [
                { name: "₹100 PayTM Cash", isReal: true }, { name: "Movie Ticket", isReal: true },
                { name: "iPhone 14", isReal: true }, { name: "Samsung TV", isReal: true },
                { name: "Smartwatch", isReal: true }, { name: "Bluetooth Speaker", isReal: true },
                { name: "AirPods", isReal: true }, { name: "Better Luck Next Time", isReal: false },
                { name: "Amazon Voucher ₹50", isReal: true }, { name: "Free Coffee Coupon", isReal: true },
                { name: "20% Discount Voucher", isReal: true }, { name: "Surprise Gift Box", isReal: true }
            ];
            const totalSegments = prizes.length;
            const segmentAngle = 360 / totalSegments;
            const winnablePrizes = prizes
                .map((prize, index) => ({ ...prize, originalIndex: index }))
                .filter(prize => prize.isReal);

            const spinWheelImage = document.getElementById('spinWheelImage');
            const spinButton = document.getElementById('spinButton');
            const gameAudioPlayer = document.getElementById('gameAudioPlayer');
            const winModal = document.getElementById('winModal');
            const winMessageInModal = document.getElementById('winMessageInModal');
            const whatsappShareButtonInModal = document.getElementById('whatsappShareButtonInModal');
            const userNameInModal = document.getElementById('userNameInModal');
            const userMobileInModal = document.getElementById('userMobileInModal');
            const successMessageArea = document.getElementById('successMessageArea');
            const confettiCanvas = document.getElementById('confettiCanvas');
            
            let confettiInstance = null;
            if (typeof confetti !== 'undefined') {
                try {
                    confettiInstance = confetti.create(confettiCanvas, { resize: true, useWorker: true });
                } catch (e) {
                    console.error("DEBUG: Error creating confetti instance:", e);
                }
            } else {
                console.warn("DEBUG: Confetti library (confetti.create) is not defined.");
            }

            let isSpinning = false;
            let currentRotation = 0;
            let currentSelectedPrize = null;

            // ZAROORI: Server par 'spin.mp3' aur 'win.mp3' ka path check karein!
            // Agar 'assets' folder mein hain, toh 'assets/spin.mp3' likhein.
            const SPIN_SOUND_SRC = "spin.mp3"; 
            const WIN_SOUND_SRC = "win.mp3";
            const GENERAL_AUDIO_VOLUME = 0.3;
            const WIN_SOUND_ADJUSTMENT = 0.15;

            // Initial element checks
            if (!spinWheelImage) console.error("DEBUG: spinWheelImage element is NOT FOUND in the DOM.");
            if (!spinButton) console.error("DEBUG: spinButton element is NOT FOUND in the DOM.");
            if (!gameAudioPlayer) console.error("DEBUG: gameAudioPlayer element is NOT FOUND in the DOM.");
            else gameAudioPlayer.volume = GENERAL_AUDIO_VOLUME;

            function playSound(soundSrc, loopSound = false) {
                if (!gameAudioPlayer) {
                    console.error("DEBUG: playSound - gameAudioPlayer not found for:", soundSrc);
                    return;
                }
                let targetVolume = (soundSrc === WIN_SOUND_SRC) ? WIN_SOUND_ADJUSTMENT : GENERAL_AUDIO_VOLUME;
                
                if (!gameAudioPlayer.paused) {
                    gameAudioPlayer.pause();
                }
                gameAudioPlayer.currentTime = 0;
                gameAudioPlayer.src = soundSrc; // Ensure this path is correct on server
                gameAudioPlayer.loop = loopSound;
                gameAudioPlayer.volume = targetVolume;
                
                const playPromise = gameAudioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.error(`DEBUG: Error playing sound ${soundSrc}:`, error);
                    });
                }
            }

            function stopSound() {
                if (gameAudioPlayer && !gameAudioPlayer.paused) {
                    gameAudioPlayer.pause();
                    gameAudioPlayer.currentTime = 0;
                }
            }

            if (spinButton && spinWheelImage) {
                spinButton.addEventListener('click', () => {
                    console.log("DEBUG: Spin button clicked. isSpinning:", isSpinning);
                    if (isSpinning) {
                        console.log("DEBUG: Already spinning. Aborting.");
                        return;
                    }
                    isSpinning = true;
                    spinButton.disabled = true;
                    spinButton.classList.remove('initial-glow');

                    stopSound();
                    if (successMessageArea) successMessageArea.classList.remove('visible');
                    if (winModal) winModal.classList.remove('visible');

                    playSound(SPIN_SOUND_SRC, true);

                    if (winnablePrizes.length === 0) {
                        console.error("DEBUG: No winnable prizes available!");
                        isSpinning = false;
                        spinButton.disabled = false;
                        return;
                    }

                    const randomIndex = Math.floor(Math.random() * winnablePrizes.length);
                    currentSelectedPrize = winnablePrizes[randomIndex];
                    const winningSegmentIndex = currentSelectedPrize.originalIndex;

                    const prizeTrueCenterAngleOnImage = winningSegmentIndex * segmentAngle;
                    const targetAngleInCycle = (360 - prizeTrueCenterAngleOnImage + 360) % 360;

                    const numFullSpins = 5 + Math.floor(Math.random() * 5); // 5-9 full spins
                    const prevFullRotations = Math.floor(currentRotation / 360);
                    let targetRotation = (prevFullRotations + numFullSpins) * 360 + targetAngleInCycle;

                    if (targetRotation <= currentRotation + 720) { // Ensure at least 2 distinct full spins
                        targetRotation += (720 + Math.floor(Math.random() * 360));
                    }
                    
                    console.log(`DEBUG: Prev Rotation: ${currentRotation}, Target Rotation: ${targetRotation}, Prize: ${currentSelectedPrize.name}`);

                    // --- Crucial part for rotation ---
                    // 1. Clear previous transition to reset animation state
                    spinWheelImage.style.transition = 'none'; 
                    
                    // 2. Force reflow/repaint. This is a trick to make sure the browser acknowledges the "no transition" state
                    //    before applying the new transition.
                    void spinWheelImage.offsetWidth; 

                    // 3. Apply the new transition
                    spinWheelImage.style.transition = 'transform 8s cubic-bezier(0.15, 0.9, 0.2, 1)';
                    
                    // 4. Apply the rotation
                    spinWheelImage.style.transform = `rotate(${targetRotation}deg)`;
                    // --- End crucial part ---
                    
                    console.log("DEBUG: Applied transform: " + spinWheelImage.style.transform);
                    console.log("DEBUG: Computed transition: " + window.getComputedStyle(spinWheelImage).transition);


                    currentRotation = targetRotation;

                    spinWheelImage.removeEventListener('transitionend', handleVisualSpinEnd); // Ensure no duplicate listeners
                    spinWheelImage.addEventListener('transitionend', handleVisualSpinEnd, { once: true });
                    console.log("DEBUG: transitionend listener attached.");
                });
            } else {
                if (!spinButton) console.error("DEBUG: spinButton event listener NOT ADDED because button not found.");
                if (!spinWheelImage) console.error("DEBUG: spinButton event listener NOT ADDED because spinWheelImage not found.");
            }

            function handleVisualSpinEnd() {
                console.log("DEBUG: transitionend event fired. Prize won:", currentSelectedPrize ? currentSelectedPrize.name : "Unknown");
                // isSpinning = false; // Re-enable for more spins if desired, currently one spin per load/claim
                // spinButton.disabled = false;

                stopSound();

                if (currentSelectedPrize) {
                    if (winMessageInModal) winMessageInModal.textContent = `Congratulations! You won ${currentSelectedPrize.name}!`;
                } else {
                    if (winMessageInModal) winMessageInModal.textContent = `Congratulations! You won a prize!`;
                }
                
                if (userNameInModal) userNameInModal.value = '';
                if (userMobileInModal) userMobileInModal.value = '';

                if (winModal) winModal.classList.add('visible');
                
                playSound(WIN_SOUND_SRC, false);

                if (confettiInstance) {
                    confettiInstance({ particleCount: 250, spread: 110, origin: { y: 0.5 }, zIndex: 9999 });
                } else {
                    console.warn("DEBUG: Confetti not fired because instance is null.");
                }
            }

            window.addEventListener('beforeunload', stopSound);

            if (whatsappShareButtonInModal) {
                whatsappShareButtonInModal.addEventListener('click', () => {
                    stopSound();
                    const userName = userNameInModal.value.trim();
                    const userMobile = userMobileInModal.value.trim();

                    if (!userName || !userMobile) {
                        alert('Please fill in Your Name and Mobile Number to claim your prize.');
                        if (!userName && userNameInModal) userNameInModal.focus();
                        else if (userMobileInModal) userMobileInModal.focus();
                        return;
                    }
                    if (!/^[6-9][0-9]{9}$/.test(userMobile)) {
                        alert('Please enter a valid 10-digit mobile number.');
                        if (userMobileInModal) userMobileInModal.focus();
                        return;
                    }

                    const ogUrlMetaTag = document.querySelector('meta[property="og:url"]');
                    const pageUrl = ogUrlMetaTag ? ogUrlMetaTag.getAttribute('content') : window.location.href;
                    
                    const prizeNameForMessage = currentSelectedPrize ? currentSelectedPrize.name : 'an Awesome Prize';
                    const userNameForMessage = userName ? userName : "I";

                    const messageText = `🎉 OMG! You won't believe this! 🎉\n\nMy name is ${userNameForMessage}, and I just won brand new *${prizeNameForMessage}* on this awesome Spin & Win game! 🤩 I've already claimed my prize! 🎁\n\nYou HAVE to try your luck too! Who knows what you might win? 😉\nTap here to spin: ${pageUrl}\n\nGood luck! 🍀`;
                    const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(messageText)}`;
                    
                    window.open(whatsappUrl, '_blank');
                    
                    if (winModal) winModal.classList.remove('visible');
                    if (successMessageArea) {
                        successMessageArea.classList.add('visible');
                        successMessageArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    
                    if (spinButton) spinButton.disabled = true;
                    // isSpinning remains true to prevent further spins after claim.
                });
            }
            console.log("DEBUG: Script initialized. Waiting for user interaction.");
        });
    </script>
</body>
</html>